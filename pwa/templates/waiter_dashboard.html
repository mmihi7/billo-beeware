<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waiter Dashboard - Billo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .waiter-header {
            background: linear-gradient(135deg, #4e73df 0%, #224abe 100%);
            color: white;
            padding: 1.5rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .waiter-card {
            transition: transform 0.2s;
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        .waiter-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        .waiter-avatar {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border: 4px solid white;
            box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1);
        }
        .quick-actions .btn {
            min-width: 120px;
            margin: 0.25rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="waiter-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <img src="{{ waiter.image }}" alt="Waiter" class="waiter-avatar rounded-circle me-3">
                    <div>
                        <h1 class="h3 mb-1">{{ waiter.name }}</h1>
                        <p class="mb-0">{{ waiter.role }} • <span class="badge bg-{{ 'success' if waiter.status == 'available' else 'danger' }}">{{ waiter.status|title }}</span></p>
                    </div>
                </div>
                <a href="/waiters" class="btn btn-outline-light">
                    <i class="fas fa-arrow-left me-1"></i> Back to Waiters
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container-fluid px-4 py-3">
        <!-- Analytics Cards -->
        <div class="row g-3 mb-4">
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-muted mb-1">Active Tabs</h6>
                                <h3 class="mb-0" id="activeTabsCount">3</h3>
                            </div>
                            <div class="bg-primary bg-opacity-10 p-3 rounded-circle">
                                <i class="fas fa-utensils text-primary fs-4"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-muted mb-1">Today's Orders</h6>
                                <h3 class="mb-0" id="todaysOrders">12</h3>
                            </div>
                            <div class="bg-success bg-opacity-10 p-3 rounded-circle">
                                <i class="fas fa-receipt text-success fs-4"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-muted mb-1">Active Orders</h6>
                                <h3 class="mb-0" id="activeOrders">5</h3>
                            </div>
                            <div class="bg-warning bg-opacity-10 p-3 rounded-circle">
                                <i class="fas fa-clock text-warning fs-4"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-muted mb-1">Today's Revenue</h6>
                                <h3 class="mb-0" id="todaysRevenue">KSh 24,500</h3>
                            </div>
                            <div class="bg-info bg-opacity-10 p-3 rounded-circle">
                                <i class="fas fa-money-bill-wave text-info fs-4"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs Section -->
        <div class="card shadow-sm border-0">
            <div class="card-header bg-white d-flex justify-content-between align-items-center border-0">
                <h5 class="mb-0">Tabs</h5>
                <div>
                    <button class="btn btn-sm btn-outline-primary me-2" id="viewGridBtn">
                        <i class="fas fa-th-large me-1"></i> Grid
                    </button>
                    <button class="btn btn-sm btn-outline-secondary me-2" id="viewListBtn">
                        <i class="fas fa-list me-1"></i> List
                    </button>
                    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#newTabModal">
                        <i class="fas fa-plus me-1"></i> New Tab
                    </button>
                </div>
            </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            <div class="list-group-item bg-light">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">Tabs</h6>
                                    <div class="d-flex
                                    ">
                                        <button class="btn btn-sm btn-outline-primary me-2" id="viewGridBtn">
                                            <i class="fas fa-th-large"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary" id="viewListBtn">
                                            <i class="fas fa-list"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="p-3">
                                <div class="row g-3" id="tabsGrid">
                                    <!-- All tabs will be inserted here by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tab Details Section (Hidden by default) -->
        <div class="row mb-4 d-none" id="tabDetailsSection">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Active Tabs <span class="badge bg-light text-dark">3</span></h5>
                        <button class="btn btn-sm btn-light" id="showAllTabs">
                            <i class="fas fa-list me-1"></i> All Tabs
                        </button>
                    </div>
                    <div class="card-body p-3">
                        <div class="d-flex flex-wrap gap-2" id="activeTabsContainer">
                            <!-- Active tabs will be added here by JavaScript -->
                            <div class="text-muted py-3 text-center w-100" id="noActiveTabs">
                                <i class="fas fa-utensils fa-2x mb-2"></i>
                                <p class="mb-0">No active tabs at the moment</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Inactive Tabs</h5>
                    </div>
                        <div>
                            <h1 class="h3 mb-1">{{ waiter.name }}</h1>
                            <p class="mb-0">{{ waiter.role }} • <span class="badge bg-{{ 'success' if waiter.status == 'available' else 'danger' }}">{{ waiter.status|title }}</span></p>
                        </div>
                    </div>
                    <a href="/waiters" class="btn btn-outline-light">
                        <i class="fas fa-arrow-left me-1"></i> Back to Waiters
                    </a>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="container-fluid px-4">
            <!-- Tabs Grid Section -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 class="mb-0">Tab Management</h4>
                        <div>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newTabModal">
                                <i class="fas fa-plus me-1"></i> New Tab
                            </button>
                        </div>
                    </div>
                    <div class="card shadow-sm mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Tabs</h5>
                            <div>
                                <button class="btn btn-sm btn-outline-primary me-2" id="viewGridBtn">
                                    <i class="fas fa-th-large"></i> Grid View
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" id="viewListBtn">
                                    <i class="fas fa-list"></i> List View
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="list-group list-group-flush">
                                <div class="list-group-item bg-light">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0">Tabs</h6>
                                        <div class="d-flex
                                        ">
                                            <button class="btn btn-sm btn-outline-primary me-2" id="viewGridBtn">
                                                <i class="fas fa-th-large"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-secondary" id="viewListBtn">
                                                <i class="fas fa-list"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-3">
                                    <div class="row g-3" id="tabsGrid">
                                        <!-- All tabs will be inserted here by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tab Details Section (Hidden by default) -->
            <div class="row mb-4 d-none" id="tabDetailsSection">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Active Tabs <span class="badge bg-light text-dark">3</span></h5>
                    <button class="btn btn-sm btn-light" id="showAllTabs">
                        <i class="fas fa-list me-1"></i> All Tabs
                    </button>
                </div>
                <div class="card-body p-3">
                    <div class="d-flex flex-wrap gap-2" id="activeTabsContainer">
                        <!-- Active tabs will be added here by JavaScript -->
                        <div class="text-muted py-3 text-center w-100" id="noActiveTabs">
                            <i class="fas fa-utensils fa-2x mb-2"></i>
                            <p class="mb-0">No active tabs at the moment</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Inactive Tabs</h5>
                </div>
                <div class="card-body p-3">
                    <div class="d-flex flex-wrap gap-2" id="inactiveTabsContainer">
                        <!-- Inactive tabs will be added here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Tab Details -->
    <div class="row mb-4 d-none" id="tabDetailsSection">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Tab <span id="currentTabNumber">#1</span> - <span id="tabStatus" class="badge bg-success">Active</span></h5>
                    <div>
                        <button class="btn btn-sm btn-outline-secondary me-2" id="viewTabOrders">
                            <i class="fas fa-list me-1"></i> View Orders
                        </button>
                        <button class="btn btn-sm btn-primary" id="addOrderBtn">
                            <i class="fas fa-plus me-1"></i> Add Order
                        </button>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Item</th>
                                    <th class="text-center">Quantity</th>
                                    <th class="text-end">Price</th>
                                    <th class="text-end">Total</th>
                                    <th class="text-end">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tabOrdersTable">
                                <!-- Orders will be added here by JavaScript -->
                                <tr>
                                    <td colspan="5" class="text-center text-muted py-4">
                                        <i class="fas fa-utensils fa-2x mb-2 d-block"></i>
                                        No orders yet
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot class="table-light">
                                <tr>
                                    <th colspan="3" class="text-end">Subtotal:</th>
                                    <th class="text-end" id="tabSubtotal">$0.00</th>
                                    <th></th>
                                </tr>
                                <tr>
                                    <th colspan="3" class="text-end">Tax (10%):</th>
                                    <th class="text-end" id="tabTax">$0.00</th>
                                    <th></th>
                                </tr>
                                <tr class="table-active">
                                    <th colspan="3" class="text-end">Total:</th>
                                    <th class="text-end" id="tabTotal">$0.00</th>
                                    <th class="text-end">
                                        <button class="btn btn-sm btn-success" id="processPaymentBtn">
                                            <i class="fas fa-credit-card me-1"></i> Process Payment
                                        </button>
                                    </th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">Billo</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Item added to order
            </div>
        </div>
    </div>

    <!-- Create Order Modal -->
    <div class="modal fade" id="createOrderModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Order to Tab <span id="modalTabNumber">#1</span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="list-group" id="menuCategories">
                                <!-- Menu categories will be added here by JavaScript -->
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="mb-3">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                                    <input type="text" class="form-control" id="menuSearch" placeholder="Search menu items...">
                                </div>
                            </div>
                            <div class="row g-2" id="menuItemsContainer">
                                <!-- Menu items will be added here by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h6>Selected Items</h6>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th class="text-center">Quantity</th>
                                        <th class="text-end">Price</th>
                                        <th class="text-end">Total</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="selectedItemsTable">
                                    <!-- Selected items will be added here by JavaScript -->
                                    <tr id="noItemsSelected">
                                        <td colspan="5" class="text-center text-muted py-2">
                                            No items selected
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot class="table-light">
                                    <tr>
                                        <th colspan="3" class="text-end">Subtotal:</th>
                                        <th class="text-end" id="orderSubtotal">$0.00</th>
                                        <th></th>
                                    </tr>
                                    <tr>
                                        <th colspan="3" class="text-end">Tax (10%):</th>
                                        <th class="text-end" id="orderTax">$0.00</th>
                                        <th></th>
                                    </tr>
                                    <tr class="table-active">
                                        <th colspan="3" class="text-end">Total:</th>
                                        <th class="text-end" id="orderTotal">$0.00</th>
                                        <th></th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitOrderBtn" disabled>
                        <i class="fas fa-paper-plane me-1"></i> Send to Kitchen
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Order Modal -->
    <div class="modal fade" id="newOrderModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">New Order for Table <span id="newOrderTabNumber"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="newOrderTabId">
                    
                    <div class="row">
                        <div class="col-md-6">
                            <!-- Customer Info -->
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">Customer Information</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">Customer Name</label>
                                        <input type="text" class="form-control" id="customerName" placeholder="Walk-in customer">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Special Instructions</label>
                                        <textarea class="form-control" id="specialInstructions" rows="2" placeholder="Any special requests or notes"></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Order Summary -->
                            <div class="card">
                                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">Order Summary</h6>
                                    <span class="badge bg-primary">0 items</span>
                                </div>
                                <div class="card-body p-0">
                                    <div class="list-group list-group-flush" id="orderItemsList">
                                        <div class="list-group-item text-center text-muted py-4">
                                            <i class="fas fa-utensils fa-2x mb-2"></i>
                                            <p class="mb-0">No items added yet</p>
                                        </div>
                                    </div>
                                    <div class="p-3 border-top">
                                        <div class="d-flex justify-content-between fw-bold mb-2">
                                            <span>Subtotal:</span>
                                            <span>KSh <span id="orderSubtotal">0.00</span></span>
                                        </div>
                                        <div class="d-flex justify-content-between text-muted small mb-3">
                                            <span>Tax (16%):</span>
                                            <span>KSh <span id="orderTax">0.00</span></span>
                                        </div>
                                        <div class="d-flex justify-content-between fw-bold fs-5">
                                            <span>Total:</span>
                                            <span>KSh <span id="orderTotal">0.00</span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <!-- Menu Categories -->
                            <div class="mb-3">
                                <div class="btn-group w-100" role="group">
                                    <button type="button" class="btn btn-outline-primary active" data-category="all">All</button>
                                    <button type="button" class="btn btn-outline-primary" data-category="food">Food</button>
                                    <button type="button" class="btn btn-outline-primary" data-category="drinks">Drinks</button>
                                    <button type="button" class="btn btn-outline-primary" data-category="desserts">Desserts</button>
                                </div>
                            </div>
                            
                            <!-- Menu Items -->
                            <div class="menu-items-container" style="max-height: 500px; overflow-y: auto;">
                                <div class="row g-2" id="menuItemsGrid">
                                    <!-- Menu items will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="submitOrderBtn">
                        <i class="fas fa-paper-plane me-1"></i> Place Order
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .tab-card {
            cursor: pointer;
            transition: all 0.2s;
            height: 100%;
        }
        .tab-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
        }
        .tab-card.active {
            border-left: 4px solid #4e73df;
        }
        .tab-card.inactive {
            opacity: 0.8;
        }
        .tab-card .card-body {
            padding: 1.25rem;
        }
        .tab-number {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .tab-status {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
        }
        #activeTabsGrid, #inactiveTabsGrid {
            min-height: 100px;
        }
    </style>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sample data - replace with actual API calls
            const tabs = [
                { 
                    id: 1, 
                    number: 'T01', 
                    status: 'active',
                    orderCount: 2, 
                    total: 4500,
                    lastActivity: '2 min ago',
                    notifications: 1, // New order ready
                    orders: [
                        { id: 1, items: [
                            { id: 101, name: 'Margherita Pizza', quantity: 1, price: 1500, notes: 'Extra cheese' },
                            { id: 102, name: 'Coke', quantity: 2, price: 150 }
                        ], status: 'ready', timestamp: '2025-08-28T17:25:00' },
                        { id: 2, items: [
                            { id: 103, name: 'Beef Burger', quantity: 1, price: 800, notes: 'No onions' }
                        ], status: 'preparing', timestamp: '2025-08-28T16:45:00' }
                    ]
                },
                { 
                    id: 2, 
                    number: 'T02', 
                    status: 'active',
                    orderCount: 1, 
                    total: 1200,
                    lastActivity: '5 min ago',
                    orders: [
                        { id: 3, items: [
                            { id: 104, name: 'Chicken Tikka', quantity: 1, price: 1200 }
                        ], status: 'delivered', timestamp: '2025-08-28T16:30:00' }
                    ]
                },
                { 
                    id: 3, 
                    number: 'T03', 
                    status: 'inactive',
                    orderCount: 0, 
                    total: 0,
                    lastActivity: '',
                    orders: []
                },
                { 
                    id: 4, 
                    number: 'T04', 
                    status: 'inactive',
                    orderCount: 0, 
                    total: 0,
                    lastActivity: '',
                    orders: []
                },
                { 
                    id: 5, 
                    number: 'T05', 
                    status: 'active',
                    orderCount: 3, 
                    total: 3200,
                    lastActivity: '10 min ago',
                    orders: [
                        { id: 4, items: [
                            { id: 105, name: 'Beef Burger', quantity: 2, price: 800 },
                            { id: 106, name: 'French Fries', quantity: 1, price: 400 }
                        ], status: 'completed', timestamp: '2025-08-28T16:15:00' },
                        { id: 5, items: [
                            { id: 107, name: 'Ice Cream', quantity: 2, price: 300 }
                        ], status: 'preparing', timestamp: '2025-08-28T16:50:00' },
                        { id: 6, items: [
                            { id: 108, name: 'Mineral Water', quantity: 1, price: 100 }
                        ], status: 'placed', timestamp: '2025-08-28T16:55:00' }
                    ]
                },
                { 
                    id: 6, 
                    number: 'T06', 
                    status: 'inactive',
                    orderCount: 0, 
                    total: 0,
                    lastActivity: '',
                    orders: []
                },
                { 
                    id: 7, 
                    number: 'T07', 
                    status: 'inactive',
                    orderCount: 0, 
                    total: 0,
                    lastActivity: '',
                    orders: []
                },
                { 
                    id: 8, 
                    number: 'T08', 
                    status: 'inactive',
                    orderCount: 0, 
                    total: 0,
                    lastActivity: '',
                    orders: []
                }
            ];

            // Menu data
            const menu = {
                categories: [
                    { id: 'food', name: 'Food' },
                    { id: 'drinks', name: 'Drinks' },
                    { id: 'desserts', name: 'Desserts' },
                    { id: 'sides', name: 'Sides' }
                ],
                items: [
                    { id: 1, name: 'Margherita Pizza', category: 'food', price: 1500, image: 'https://via.placeholder.com/100' },
                    { id: 2, name: 'Pepperoni Pizza', category: 'food', price: 1800, image: 'https://via.placeholder.com/100' },
                    { id: 3, name: 'Chicken Tikka', category: 'food', price: 1200, image: 'https://via.placeholder.com/100' },
                    { id: 4, name: 'Beef Burger', category: 'food', price: 800, image: 'https://via.placeholder.com/100' },
                    { id: 5, name: 'Coke', category: 'drinks', price: 150, image: 'https://via.placeholder.com/100' },
                    { id: 6, name: 'Fanta', category: 'drinks', price: 150, image: 'https://via.placeholder.com/100' },
                    { id: 7, name: 'Mineral Water', category: 'drinks', price: 100, image: 'https://via.placeholder.com/100' },
                    { id: 8, name: 'Ice Cream', category: 'desserts', price: 300, image: 'https://via.placeholder.com/100' },
                    { id: 9, name: 'Chocolate Cake', category: 'desserts', price: 500, image: 'https://via.placeholder.com/100' },
                    { id: 10, name: 'French Fries', category: 'sides', price: 400, image: 'https://via.placeholder.com/100' },
                    { id: 11, name: 'Garlic Bread', category: 'sides', price: 350, image: 'https://via.placeholder.com/100' },
                    { id: 12, name: 'Onion Rings', category: 'sides', price: 450, image: 'https://via.placeholder.com/100' }
                ]
            };

            let currentTab = null;
            let selectedItems = [];
            const createOrderModal = new bootstrap.Modal(document.getElementById('createOrderModal'));

            // Global variables
            let currentOrder = {
                items: [],
                customerName: '',
                specialInstructions: '',
                tabId: null
            };

            // Function to update the stats cards at the top of the dashboard
            function updateStats() {
                const activeTabs = tabs.filter(tab => tab.status === 'active').length;
                const activeOrders = tabs.reduce((sum, tab) => 
                    sum + tab.orders.filter(order => 
                        ['preparing', 'ready'].includes(order.status)
                    ).length, 0);
                
                // Calculate today's stats
                const today = new Date().toISOString().split('T')[0];
                const todaysOrders = tabs.reduce((sum, tab) => 
                    sum + tab.orders.filter(order => 
                        order.timestamp && order.timestamp.startsWith(today)
                    ).length, 0);
                
                const todaysRevenue = tabs.reduce((sum, tab) => 
                    sum + tab.orders
                        .filter(order => order.timestamp && order.timestamp.startsWith(today))
                        .reduce((orderSum, order) => 
                            orderSum + order.items.reduce((itemSum, item) => 
                                itemSum + (item.price * item.quantity), 0
                            ), 0
                        ), 0);
                
                // Update the UI
                const activeTabsEl = document.getElementById('activeTabsCount');
                const todaysOrdersEl = document.getElementById('todaysOrders');
                const activeOrdersEl = document.getElementById('activeOrders');
                const todaysRevenueEl = document.getElementById('todaysRevenue');
                
                if (activeTabsEl) activeTabsEl.textContent = activeTabs;
                if (todaysOrdersEl) todaysOrdersEl.textContent = todaysOrders;
                if (activeOrdersEl) activeOrdersEl.textContent = activeOrders;
                if (todaysRevenueEl) todaysRevenueEl.textContent = `KSh ${todaysRevenue.toLocaleString()}`;
            }
            
            // Initialize the dashboard
            function initDashboard() {
                renderTabs();
                updateStats();
                setupEventListeners();
                
                // Initialize the new order modal
                const newOrderModal = document.getElementById('newOrderModal');
                if (newOrderModal) {
                    newOrderModal.addEventListener('shown.bs.modal', function () {
                        // Reset order form when modal is shown
                        resetOrderForm();
                    });
                }
            }

            // Render all tabs in a single grid
            function renderTabs() {
                const tabsContainer = document.getElementById('tabsGrid');
                if (!tabsContainer) return;
                
                // Clear existing content
                tabsContainer.innerHTML = '';
                
                // Sort tabs by status (active first) and then by number
                const sortedTabs = [...tabs].sort((a, b) => {
                    if (a.status === b.status) {
                        return a.number.localeCompare(b.number);
                    }
                    return a.status === 'active' ? -1 : 1;
                });
                
                // Render each tab
                sortedTabs.forEach(tab => {
                    const tabElement = createTabCard(tab);
                    tabsContainer.appendChild(tabElement);
                });
                
                // Update stats after rendering tabs
                updateStats();
            }

            // Create a tab card element
            function createTabCard(tab) {
                const card = document.createElement('div');
                const isActive = tab.status === 'active';

                // Calculate notification count (ready orders)
                const notificationCount = tab.orders.reduce((count, order) => 
                    count + (order.status === 'ready' ? 1 : 0), 0);
                
                // Calculate total items in all orders
                const totalItems = tab.orders.reduce((sum, order) => 
                    sum + order.items.reduce((itemSum, item) => itemSum + item.quantity, 0), 0);
                
                // Calculate total amount for the tab
                const totalAmount = tab.orders.reduce((sum, order) => 
                    sum + order.items.reduce((itemSum, item) => 
                        itemSum + (item.price * item.quantity), 0), 0);
                
                card.className = `card tab-card mb-3 ${isActive ? '' : 'bg-light'} col-md-3 col-6`;
                
                card.innerHTML = `
                    <div class="card-body position-relative">
                        ${notificationCount > 0 ? `
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                ${notificationCount}
                                <span class="visually-hidden">notifications</span>
                            </span>
                        ` : ''}
                        <h5 class="tab-number mb-2 d-flex justify-content-between align-items-center">
                            <span>${tab.number}</span>
                            <span class="badge bg-${isActive ? 'primary' : 'secondary'}">
                                ${isActive ? 'Active' : 'Inactive'}
                            </span>
                        </h5>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted">
                                <i class="fas fa-shopping-bag me-1"></i>
                                ${totalItems} ${totalItems === 1 ? 'item' : 'items'}
                            </span>
                            <span class="fw-bold">KSh ${totalAmount.toLocaleString()}</span>
                        </div>
                        ${isActive ? `
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <div>
                                    <span class="small text-muted me-2">${tab.lastActivity}</span>
                                    ${tab.notifications ? `
                                        <span class="badge rounded-pill bg-danger">
                                            ${tab.notifications} ${tab.notifications === 1 ? 'alert' : 'alerts'}
                                        </span>
                                    ` : ''}
                                </div>
                                <button class="btn btn-sm btn-outline-primary" 
                                    onclick="event.stopPropagation(); openNewOrderModal(${tab.id}, '${tab.number}')">
                                    <i class="fas fa-plus"></i> Order
                                </button>
                            </div>
                        ` : `
                            <div class="text-center py-3">
                                <button class="btn btn-sm btn-outline-primary" 
                                    onclick="event.stopPropagation(); openNewOrderModal(${tab.id}, '${tab.number}')">
                                    <i class="fas fa-plus"></i> Start New Tab
                                </button>
                            </div>
                        `}
                    </div>
                `;
                
                card.addEventListener('click', () => selectTab(tab.id));
                return card;
            }

            // Make openNewOrderModal available globally
            window.openNewOrderModal = function(tabId, tabNumber) {
                const modal = new bootstrap.Modal(document.getElementById('newOrderModal'));
                document.getElementById('newOrderTabNumber').textContent = tabNumber;
                document.getElementById('newOrderTabId').value = tabId;
                modal.show();
            };

            // Select a tab and show its details
            function selectTab(tabId) {
                currentTab = tabs.find(tab => tab.id === tabId);
                if (!currentTab) return;
                
                // Update UI
                document.getElementById('currentTabNumber').textContent = currentTab.number;
                document.getElementById('tabStatus').className = `badge ${currentTab.status === 'active' ? 'bg-success' : 'bg-secondary'}`;
                document.getElementById('tabStatus').textContent = currentTab.status === 'active' ? 'Active' : 'Inactive';
                
                // Render tab orders
                renderTabOrders();
                
                // Show the details section
                document.getElementById('tabDetailsSection').classList.remove('d-none');
                
                // Scroll to details
                document.getElementById('tabDetailsSection').scrollIntoView({ behavior: 'smooth' });
            }
            
            // Render orders for the selected tab
            function renderTabOrders() {
                if (!currentTab) return;
                
                const tbody = document.getElementById('tabOrdersTable');
                tbody.innerHTML = '';
                
                if (currentTab.orders.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center text-muted py-4">
                                <i class="fas fa-utensils fa-2x mb-2 d-block"></i>
                                No orders yet
                            </td>
                        </tr>
                    `;
                    updateTabTotals();
                    return;
                }
                
                currentTab.orders.forEach(order => {
                    const total = order.price * order.quantity;
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0 me-2">
                                    <span class="badge bg-light text-dark">#${order.id}</span>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="fw-bold">${order.item}</div>
                                    ${order.notes ? `<small class="text-muted">${order.notes}</small>` : ''}
                                </div>
                            </div>
                        </td>
                        <td class="text-center">${order.quantity}</td>
                        <td class="text-end">$${order.price.toFixed(2)}</td>
                        <td class="text-end">$${total.toFixed(2)}</td>
                        <td class="text-end">
                            <button class="btn btn-sm btn-outline-danger" onclick="removeOrder(${order.id})">
                                <i class="fas fa-times"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                updateTabTotals();
            }
            
            // Update the tab totals
            function updateTabTotals() {
                if (!currentTab) return;
                
                const subtotal = currentTab.orders.reduce((sum, order) => sum + (order.price * order.quantity), 0);
                const tax = subtotal * 0.1; // 10% tax
                const total = subtotal + tax;
                
                document.getElementById('tabSubtotal').textContent = `$${subtotal.toFixed(2)}`;
                document.getElementById('tabTax').textContent = `$${tax.toFixed(2)}`;
                document.getElementById('tabTotal').textContent = `$${total.toFixed(2)}`;
            }
            
            // Render menu categories
            function renderMenuCategories() {
                const container = document.getElementById('menuCategories');
                container.innerHTML = '';
                
                menu.categories.forEach((category, index) => {
                    const button = document.createElement('button');
                    button.type = 'button';
                    button.className = `list-group-item list-group-item-action ${index === 0 ? 'active' : ''}`;
                    button.textContent = category;
                    button.dataset.category = category;
                    button.addEventListener('click', () => filterMenuByCategory(category));
                    container.appendChild(button);
                });
            }
            
            // Render menu items
            function renderMenuItems(filter = '') {
                const container = document.getElementById('menuItemsContainer');
                container.innerHTML = '';
                
                let filteredItems = [...menu.items];
                
                // Apply search filter
                if (filter) {
                    const searchTerm = filter.toLowerCase();
                    filteredItems = filteredItems.filter(item => 
                        item.name.toLowerCase().includes(searchTerm) || 
                        item.category.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (filteredItems.length === 0) {
                    container.innerHTML = `
                        <div class="col-12 text-center py-4">
                            <i class="fas fa-search fa-2x mb-2 text-muted"></i>
                            <p class="mb-0">No items found</p>
                        </div>
                    `;
                    return;
                }
                
                filteredItems.forEach(item => {
                    const col = document.createElement('div');
                    col.className = 'col-6 col-md-4 col-lg-3';
                    col.innerHTML = `
                        <div class="card h-100 menu-item" data-id="${item.id}">
                            <img src="${item.image}" class="card-img-top" alt="${item.name}" style="height: 100px; object-fit: cover;">
                            <div class="card-body p-2">
                                <h6 class="card-title mb-1">${item.name}</h6>
                                <p class="card-text text-muted small mb-1">${item.category}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="fw-bold">$${item.price.toFixed(2)}</span>
                                    <button class="btn btn-sm btn-outline-primary add-to-order" data-id="${item.id}">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(col);
                });
                
                // Add event listeners to add buttons
                document.querySelectorAll('.add-to-order').forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const itemId = parseInt(button.dataset.id);
                        addToOrder(itemId);
                    });
                });
                
                // Add click event to menu items
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('add-to-order') && !e.target.closest('.add-to-order')) {
                            const itemId = parseInt(item.dataset.id);
                            addToOrder(itemId);
                        }
                    });
                });
            }
            
            // Filter menu by category
            function filterMenuByCategory(category) {
                const menuItems = document.querySelectorAll('#menuItemsGrid .card');
                
                menuItems.forEach(item => {
                    const itemCategory = item.querySelector('.badge').textContent.toLowerCase();
                    if (category === 'all' || itemCategory === category.toLowerCase()) {
                        item.closest('.col-6').style.display = 'block';
                    } else {
                        item.closest('.col-6').style.display = 'none';
                    }
                });
                
                document.querySelectorAll('#menuCategories .list-group-item').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.category === category);
                });
                
                // Filter items
                const filteredItems = menu.items.filter(item => item.category === category);
                renderMenuItems('', filteredItems);
            }
            
            // Add item to order
            function addToOrder(itemId) {
                const item = menu.items.find(i => i.id === itemId);
                if (!item) return;
                
                const existingItem = selectedItems.find(i => i.id === itemId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    selectedItems.push({
                        ...item,
                        quantity: 1,
                        notes: ''
                    });
                }
                
                renderSelectedItems();
            }
            
            // Render selected items in the order
            function renderSelectedItems() {
                const tbody = document.getElementById('selectedItemsTable');
                const noItemsRow = document.getElementById('noItemsSelected');
                
                if (selectedItems.length === 0) {
                    noItemsRow.classList.remove('d-none');
                    document.getElementById('submitOrderBtn').disabled = true;
                    updateOrderTotals();
                    return;
                }
                
                noItemsRow.classList.add('d-none');
                tbody.innerHTML = '';
                
                selectedItems.forEach((item, index) => {
                    const total = item.price * item.quantity;
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="${item.image}" alt="${item.name}" style="width: 40px; height: 40px; object-fit: cover;" class="rounded me-2">
                                <div>
                                    <div class="fw-bold">${item.name}</div>
                                    <small class="text-muted">${item.category}</small>
                                </div>
                            </div>
                        </td>
                        <td class="text-center">
                            <div class="input-group input-group-sm" style="width: 100px;">
                                <button class="btn btn-outline-secondary" type="button" onclick="updateQuantity(${index}, -1)">-</button>
                                <input type="number" class="form-control text-center" value="${item.quantity}" min="1" onchange="updateQuantity(${index}, 0, this.value)">
                                <button class="btn btn-outline-secondary" type="button" onclick="updateQuantity(${index}, 1)">+</button>
                            </div>
                        </td>
                        <td class="text-end">$${item.price.toFixed(2)}</td>
                        <td class="text-end">$${total.toFixed(2)}</td>
                        <td class="text-end">
                            <button class="btn btn-sm btn-outline-danger" onclick="removeItem(${index})">
                                <i class="fas fa-times"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                document.getElementById('submitOrderBtn').disabled = false;
                updateOrderTotals();
            }
            
            // Update item quantity
            window.updateQuantity = function(index, change, value) {
                if (value !== undefined) {
                    selectedItems[index].quantity = parseInt(value) || 1;
                } else {
                    selectedItems[index].quantity += change;
                    if (selectedItems[index].quantity < 1) {
                        selectedItems[index].quantity = 1;
                    }
                }
                renderSelectedItems();
            };
            
            // Remove item from order
            window.removeItem = function(index) {
                selectedItems.splice(index, 1);
                renderSelectedItems();
            };
            
            // Update order totals
            function updateOrderTotals() {
                const subtotal = selectedItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const tax = subtotal * 0.1; // 10% tax
                const total = subtotal + tax;
                
                document.getElementById('orderSubtotal').textContent = `$${subtotal.toFixed(2)}`;
                document.getElementById('orderTax').textContent = `$${tax.toFixed(2)}`;
                document.getElementById('orderTotal').textContent = `$${total.toFixed(2)}`;
            }
            
            // Reset the order form
            function resetOrderForm() {
                currentOrder = {
                    items: [],
                    customerName: '',
                    specialInstructions: '',
                    tabId: document.getElementById('newOrderTabId').value
                };
                
                // Update UI
                document.getElementById('customerName').value = '';
                document.getElementById('specialInstructions').value = '';
                renderOrderItems();
                updateOrderSummary();
                
                // Set focus to customer name field
                document.getElementById('customerName').focus();
            }

            // Render menu items in the order modal
            function renderMenuItems() {
                const menuItemsContainer = document.getElementById('menuItemsGrid');
                if (!menuItemsContainer) return;
                
                menuItemsContainer.innerHTML = '';
                
                menu.items.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'col-6 col-md-4 mb-3';
                    itemElement.innerHTML = `
                        <div class="card h-100" onclick="addToOrder(${item.id})">
                            <img src="${item.image}" class="card-img-top" alt="${item.name}" style="height: 100px; object-fit: cover;">
                            <div class="card-body p-2">
                                <h6 class="card-title mb-1">${item.name}</h6>
                                <p class="card-text text-muted mb-1">KSh ${item.price.toLocaleString()}</p>
                                <span class="badge bg-secondary">${menu.categories.find(cat => cat.id === item.category)?.name || item.category}</span>
                            </div>
                        </div>
                    `;
                    menuItemsContainer.appendChild(itemElement);
                });
            }

            // Add item to order
            window.addToOrder = function(itemId) {
                const item = menu.items.find(i => i.id === itemId);
                if (!item) return;
                
                // Check if item already exists in order
                const existingItem = currentOrder.items.find(i => i.id === itemId);
                
                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    currentOrder.items.push({
                        id: item.id,
                        name: item.name,
                        price: item.price,
                        quantity: 1,
                        notes: ''
                    });
                }
                
                renderOrderItems();
                updateOrderSummary();
                
                // Show success message
                const toast = new bootstrap.Toast(document.getElementById('toast'));
                document.getElementById('toastMessage').textContent = `${item.name} added to order`;
                toast.show();
            };

            // Remove item from order
            window.removeOrderItem = function(itemId) {
                const index = currentOrder.items.findIndex(i => i.id === itemId);
                if (index !== -1) {
                    currentOrder.items.splice(index, 1);
                    renderOrderItems();
                    updateOrderSummary();
                }
            };

            // Update item quantity
            window.updateQuantity = function(itemId, change) {
                const item = currentOrder.items.find(i => i.id === itemId);
                if (!item) return;
                
                item.quantity = Math.max(1, item.quantity + change);
                renderOrderItems();
                updateOrderSummary();
            };

            // Render order items in the summary
            function renderOrderItems() {
                const orderItemsList = document.getElementById('orderItemsList');
                if (!orderItemsList) return;
                
                if (currentOrder.items.length === 0) {
                    orderItemsList.innerHTML = `
                        <div class="list-group-item text-center text-muted py-4">
                            <i class="fas fa-utensils fa-2x mb-2"></i>
                            <p class="mb-0">No items added yet</p>
                        </div>
                    `;
                    return;
                }
                
                orderItemsList.innerHTML = currentOrder.items.map(item => `
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">${item.name}</h6>
                                <div class="d-flex align-items-center mt-1">
                                    <button class="btn btn-sm btn-outline-secondary p-0 px-2" onclick="event.stopPropagation(); updateQuantity(${item.id}, -1)">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span class="mx-2">${item.quantity}</span>
                                    <button class="btn btn-sm btn-outline-secondary p-0 px-2" onclick="event.stopPropagation(); updateQuantity(${item.id}, 1)">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                    <span class="ms-3 fw-bold">KSh ${(item.price * item.quantity).toLocaleString()}</span>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-outline-danger" onclick="event.stopPropagation(); removeOrderItem(${item.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            // Update order summary
            function updateOrderSummary() {
                const subtotal = currentOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const tax = subtotal * 0.16; // 16% tax
                const total = subtotal + tax;
                
                document.getElementById('orderSubtotal').textContent = subtotal.toLocaleString('en-US', { minimumFractionDigits: 2 });
                document.getElementById('orderTax').textContent = tax.toLocaleString('en-US', { minimumFractionDigits: 2 });
                document.getElementById('orderTotal').textContent = total.toLocaleString('en-US', { minimumFractionDigits: 2 });
                
                // Update items count badge
                const itemsCount = currentOrder.items.reduce((sum, item) => sum + item.quantity, 0);
                document.querySelector('.card-header .badge').textContent = `${itemsCount} item${itemsCount !== 1 ? 's' : ''}`;
            }

            // Submit order
            function submitOrder() {
                if (currentOrder.items.length === 0) {
                    alert('Please add at least one item to the order');
                    return;
                }
                
                // Update order details
                currentOrder.customerName = document.getElementById('customerName').value || 'Walk-in';
                currentOrder.specialInstructions = document.getElementById('specialInstructions').value;
                
                // In a real app, you would send this data to the server here
                console.log('Submitting order:', currentOrder);
                
                // Show success message
                const toast = new bootstrap.Toast(document.getElementById('toast'));
                document.getElementById('toastMessage').textContent = 'Order submitted successfully!';
                toast.show();
                
                // Close the modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('newOrderModal'));
                modal.hide();
                
                // Update the tab to show it's now active
                const tab = tabs.find(t => t.id === parseInt(currentOrder.tabId));
                if (tab) {
                    tab.status = 'active';
                    tab.customer = currentOrder.customerName;
                    tab.orderCount = currentOrder.items.reduce((sum, item) => sum + item.quantity, 0);
                    tab.total = currentOrder.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                    tab.lastActivity = 'Just now';
                    tab.orders = currentOrder.items;
                    
                    renderTabs();
                }
            }

            // Setup event listeners
            function setupEventListeners() {
                // Submit order button
                const submitBtn = document.getElementById('submitOrderBtn');
                if (submitBtn) {
                    submitBtn.addEventListener('click', submitOrder);
                }
                
                // Category filter buttons
                document.querySelectorAll('[data-category]').forEach(button => {
                    button.addEventListener('click', function() {
                        const category = this.getAttribute('data-category');
                        filterMenuByCategory(category);
                        
                        // Update active state
                        document.querySelectorAll('[data-category]').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        this.classList.add('active');
                    });
                });
                // Search menu items
                document.getElementById('menuSearch').addEventListener('input', (e) => {
                    renderMenuItems(e.target.value);
                });
                
                // Add Order button
                document.getElementById('addOrderBtn').addEventListener('click', () => {
                    if (!currentTab) return;
                    document.getElementById('modalTabNumber').textContent = currentTab.number;
                    selectedItems = [];
                    renderSelectedItems();
                    createOrderModal.show();
                });
                
                // Submit order
                document.getElementById('submitOrderBtn').addEventListener('click', () => {
                    if (!currentTab || selectedItems.length === 0) return;
                    
                    // Add items to tab's orders
                    selectedItems.forEach(item => {
                        const orderId = Math.floor(Math.random() * 1000); // Generate a random order ID
                        currentTab.orders.push({
                            id: orderId,
                            item: item.name,
                            quantity: item.quantity,
                            price: item.price,
                            notes: item.notes || ''
                        });
                    });
                    
                    // Update tab status if it was inactive
                    if (currentTab.status === 'inactive') {
                        currentTab.status = 'active';
                        renderTabs();
                    }
                    
                    // Update UI
                    renderTabOrders();
                    createOrderModal.hide();
                    
                    // Show success message
                    alert('Order sent to kitchen successfully!');
                });
                
                // Show all tabs
                document.getElementById('showAllTabs').addEventListener('click', () => {
                    document.getElementById('inactiveTabsContainer').scrollIntoView({ behavior: 'smooth' });
                });
            }
            
            // Initialize the dashboard when the DOM is loaded
            initDashboard();
            
            // View toggle functionality
            document.getElementById('viewGridBtn')?.addEventListener('click', function() {
                const cards = document.querySelectorAll('.tab-card');
                if (cards.length === 0) return;
                
                cards.forEach(card => {
                    card.classList.remove('col-12');
                    card.classList.add('col-md-3', 'col-6');
                });
                
                this.classList.remove('btn-outline-primary');
                this.classList.add('btn-primary');
                
                const listBtn = document.getElementById('viewListBtn');
                if (listBtn) {
                    listBtn.classList.remove('btn-primary');
                    listBtn.classList.add('btn-outline-secondary');
                }
            });
            
            document.getElementById('viewListBtn')?.addEventListener('click', function() {
                const cards = document.querySelectorAll('.tab-card');
                if (cards.length === 0) return;
                
                cards.forEach(card => {
                    card.classList.remove('col-md-3', 'col-6');
                    card.classList.add('col-12');
                });
                
                this.classList.remove('btn-outline-secondary');
                this.classList.add('btn-primary');
                
                const gridBtn = document.getElementById('viewGridBtn');
                if (gridBtn) {
                    gridBtn.classList.remove('btn-primary');
                    gridBtn.classList.add('btn-outline-primary');
                }
            });
            
            // Set default to grid view if elements exist
            const gridBtn = document.getElementById('viewGridBtn');
            if (gridBtn) {
                gridBtn.click();
            }
            
            // Make functions available globally for inline event handlers
            window.removeOrder = function(orderId) {
                if (!currentTab) return;
                
                const index = currentTab.orders.findIndex(order => order.id === orderId);
                if (index !== -1) {
                    if (confirm('Are you sure you want to remove this item from the order?')) {
                        currentTab.orders.splice(index, 1);
                        renderTabOrders();
                        
                        // If no more orders, update tab status
                        if (currentTab.orders.length === 0) {
                            currentTab.status = 'inactive';
                            renderTabs();
                        }
                    }
                }
            };
        });
    </script>
</body>
</html>
