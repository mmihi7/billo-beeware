{% extends "base.html" %}

{% block title %}Menu - {{ restaurant_name }}{% endblock %}

{% block extra_css %}
<style>
    .menu-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .menu-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    .category-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        overflow-x: auto;
        padding-bottom: 5px;
    }
    
    .category-tab {
        padding: 8px 16px;
        background: #f3f4f6;
        border-radius: 20px;
        cursor: pointer;
        white-space: nowrap;
        transition: all 0.2s;
    }
    
    .category-tab.active {
        background: #4f46e5;
        color: white;
    }
    
    .category-tab:hover:not(.active) {
        background: #e5e7eb;
    }
    
    .menu-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .menu-item-card {
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .menu-item-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .menu-item-image {
        width: 100%;
        height: 180px;
        object-fit: cover;
    }
    
    .menu-item-details {
        padding: 16px;
    }
    
    .menu-item-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
    }
    
    .menu-item-name {
        font-weight: 600;
        font-size: 1.1em;
        margin: 0;
    }
    
    .menu-item-price {
        font-weight: 600;
        color: #4f46e5;
    }
    
    .menu-item-description {
        color: #6b7280;
        font-size: 0.9em;
        margin-bottom: 12px;
    }
    
    .menu-item-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .quantity-selector {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .quantity-btn {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 1px solid #e5e7eb;
        background: white;
        font-size: 1.1em;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .quantity-display {
        min-width: 30px;
        text-align: center;
    }
    
    .add-to-order-btn {
        background: #4f46e5;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 6px 12px;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    .add-to-order-btn:hover {
        background: #4338ca;
    }
    
    .add-to-order-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
    }
    
    .menu-category {
        margin-bottom: 30px;
    }
    
    .category-title {
        font-size: 1.3em;
        font-weight: 600;
        margin: 20px 0 15px;
        padding-bottom: 8px;
        border-bottom: 2px solid #e5e7eb;
    }
    
    .search-container {
        margin-bottom: 20px;
    }
    
    .search-input {
        width: 100%;
        max-width: 400px;
        padding: 10px 15px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        font-size: 1em;
    }
    
    @media (max-width: 768px) {
        .menu-grid {
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        }
        
        .menu-header {
            flex-direction: column;
            align-items: flex-start;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="menu-container">
    <div class="menu-header">
        <h1>Menu</h1>
        <div class="search-container">
            <input 
                type="text" 
                id="menu-search" 
                class="search-input" 
                placeholder="Search menu items..."
                onkeyup="filterMenuItems()"
            >
        </div>
    </div>
    
    <div class="category-tabs" id="category-tabs">
        <button class="category-tab active" data-category="all">All Items</button>
        {% for category in categories %}
        <button class="category-tab" data-category="{{ category.id }}">{{ category.name }}</button>
        {% endfor %}
    </div>
    
    {% for category in categories %}
    <div class="menu-category" id="category-{{ category.id }}">
        <h2 class="category-title">{{ category.name }}</h2>
        <div class="menu-grid">
            {% for item in menu_items %}
                {% if item.category_id == category.id %}
                <div class="menu-item-card" data-categories="{{ item.category_id }}" data-name="{{ item.name|lower }}">
                    {% if item.image_url %}
                    <img src="{{ item.image_url }}" alt="{{ item.name }}" class="menu-item-image">
                    {% else %}
                    <div class="menu-item-image" style="background: #f3f4f6; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-utensils fa-3x text-gray-300"></i>
                    </div>
                    {% endif %}
                    <div class="menu-item-details">
                        <div class="menu-item-header">
                            <h3 class="menu-item-name">{{ item.name }}</h3>
                            <span class="menu-item-price">KSh {{ "%0.2f"|format(item.price / 100) }}</span>
                        </div>
                        {% if item.description %}
                        <p class="menu-item-description">{{ item.description }}</p>
                        {% endif %}
                        <div class="menu-item-actions">
                            <div class="quantity-selector">
                                <button class="quantity-btn" onclick="updateQuantity('{{ item.id }}', -1)">-</button>
                                <span class="quantity-display" id="quantity-{{ item.id }}">0</span>
                                <button class="quantity-btn" onclick="updateQuantity('{{ item.id }}', 1)">+</button>
                            </div>
                            <button 
                                class="add-to-order-btn" 
                                id="add-btn-{{ item.id }}"
                                onclick="addToOrder('{{ item.id }}')"
                                disabled
                            >
                                Add to Order
                            </button>
                        </div>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endfor %}
    
    <!-- Floating Order Summary -->
    <div class="floating-order-summary" id="order-summary">
        <div class="order-summary-header">
            <span>Order Summary</span>
            <span id="order-total">KSh 0.00</span>
        </div>
        <div class="order-items" id="order-items">
            <!-- Order items will be added here dynamically -->
        </div>
        <button class="btn btn-primary btn-block mt-3" id="checkout-btn" disabled>
            Proceed to Checkout
        </button>
    </div>
</div>
{% endblock %}

<!-- Store menu items data for JavaScript -->
<div id="menu-data" data-items='{{ menu_items|tojson|safe }}' style="display: none;"></div>

{% block extra_js %}
<script src="{{ url_for('static', path='/js/menu.js') }}"></script>

<script>
// Filter menu items by category
document.querySelectorAll('.category-tab').forEach(tab => {
    tab.addEventListener('click', () => {
            const category = tab.dataset.category;
            
            // Update active tab
            document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            // Show/hide categories
            if (category === 'all') {
                document.querySelectorAll('.menu-category').forEach(cat => {
                    cat.style.display = 'block';
                });
            } else {
                document.querySelectorAll('.menu-category').forEach(cat => {
                    cat.style.display = 'none';
                });
                document.getElementById(`category-${category}`).style.display = 'block';
            }
        });
    });
    
    // Filter menu items by search term
    function filterMenuItems() {
        const searchTerm = document.getElementById('menu-search').value.toLowerCase();
        const items = document.querySelectorAll('.menu-item-card');
        
        items.forEach(item => {
            const itemName = item.dataset.name;
            if (itemName.includes(searchTerm)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }
    
    // Update order summary
    function updateOrderSummary() {
        let total = 0;
        const orderItems = [];
        
        // Calculate total and collect items
        for (const [itemId, quantity] of Object.entries(quantities)) {
            if (quantity > 0) {
                // In a real app, we'd fetch the item details from the server
                const itemPrice = 0; // Replace with actual price from data
                total += quantity * itemPrice;
                orderItems.push({ id: itemId, quantity });
            }
        }
        
        // Update UI
        document.getElementById('order-total').textContent = `KSh ${(total / 100).toFixed(2)}`;
        
        const orderItemsContainer = document.getElementById('order-items');
        orderItemsContainer.innerHTML = orderItems
            .map(item => `
                <div class="order-item">
                    <span>Item ${item.id}</span>
                    <span>${item.quantity} x KSh ${(item.quantity * 100 / 100).toFixed(2)}</span>
                </div>
            `)
            .join('');
        
        // Enable/disable checkout button
        document.getElementById('checkout-btn').disabled = orderItems.length === 0;
    }
</script>
{% endblock %}
