{% extends "base.html" %}

{% block title %}Settings - {{ restaurant_name }}{% endblock %}

{% block extra_css %}
<style>
    .settings-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .settings-header {
        margin-bottom: 30px;
    }
    
    .settings-tabs {
        display: flex;
        border-bottom: 1px solid #e5e7eb;
        margin-bottom: 20px;
    }
    
    .settings-tab {
        padding: 10px 20px;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        margin-right: 10px;
        font-weight: 500;
        color: #6b7280;
        transition: all 0.2s;
    }
    
    .settings-tab.active {
        color: #4f46e5;
        border-bottom-color: #4f46e5;
    }
    
    .settings-tab:hover:not(.active) {
        color: #4f46e5;
        border-bottom-color: #e5e7eb;
    }
    
    .settings-content {
        background: white;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        padding: 25px;
    }
    
    .settings-section {
        margin-bottom: 30px;
        display: none;
    }
    
    .settings-section.active {
        display: block;
    }
    
    .section-title {
        font-size: 1.25em;
        font-weight: 600;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
    }
    
    .form-control {
        width: 100%;
        max-width: 500px;
        padding: 10px 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 0.95em;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #4f46e5;
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }
    
    .btn {
        padding: 10px 20px;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
    }
    
    .btn-primary {
        background-color: #4f46e5;
        color: white;
    }
    
    .btn-primary:hover {
        background-color: #4338ca;
    }
    
    .btn-outline {
        background: white;
        border: 1px solid #d1d5db;
        color: #374151;
    }
    
    .btn-outline:hover {
        background-color: #f9fafb;
    }
    
    .business-hours {
        width: 100%;
        max-width: 500px;
    }
    
    .business-hour-row {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        padding: 10px;
        background: #f9fafb;
        border-radius: 6px;
    }
    
    .day-label {
        min-width: 100px;
        font-weight: 500;
    }
    
    .time-inputs {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .time-input {
        padding: 8px 10px;
        border: 1px solid #d1d5db;
        border-radius: 4px;
    }
    
    .closed-checkbox {
        margin-left: auto;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .staff-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .staff-table th, 
    .staff-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .staff-table th {
        font-weight: 600;
        color: #4b5563;
        background-color: #f9fafb;
    }
    
    .status-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: 500;
    }
    
    .status-active {
        background-color: #d1fae5;
        color: #065f46;
    }
    
    .status-inactive {
        background-color: #fee2e2;
        color: #991b1b;
    }
    
    .action-btns {
        display: flex;
        gap: 8px;
    }
    
    .btn-sm {
        padding: 5px 10px;
        font-size: 0.85em;
    }
    
    .btn-icon {
        padding: 5px;
        border-radius: 4px;
    }
    
    .btn-icon:hover {
        background-color: #f3f4f6;
    }
    
    .tab-content {
        display: none;
    }
    
    .tab-content.active {
        display: block;
    }
    
    @media (max-width: 768px) {
        .settings-container {
            padding: 10px;
        }
        
        .settings-tabs {
            overflow-x: auto;
            padding-bottom: 5px;
        }
        
        .settings-content {
            padding: 15px;
        }
        
        .business-hour-row {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .time-inputs {
            width: 100%;
        }
        
        .closed-checkbox {
            margin-left: 0;
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="settings-container">
    <div class="settings-header">
        <h1>Settings</h1>
        <p class="text-gray-600">Manage your restaurant settings and preferences</p>
    </div>
    
    <div class="settings-tabs">
        <div class="settings-tab active" data-tab="profile">Profile</div>
        <div class="settings-tab" data-tab="business-hours">Business Hours</div>
        <div class="settings-tab" data-tab="menu">Menu Management</div>
        <div class="settings-tab" data-tab="staff">Staff</div>
        <div class="settings-tab" data-tab="notifications">Notifications</div>
        <div class="settings-tab" data-tab="billing">Billing</div>
    </div>
    
    <div class="settings-content">
        <!-- Profile Tab -->
        <div id="profile-tab" class="tab-content active">
            <h2 class="section-title">Restaurant Profile</h2>
            
            <form id="profile-form">
                <div class="form-group">
                    <label class="form-label" for="restaurant-name">Restaurant Name</label>
                    <input type="text" id="restaurant-name" class="form-control" value="{{ restaurant.name }}" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="restaurant-address">Address</label>
                    <input type="text" id="restaurant-address" class="form-control" value="{{ restaurant.address }}">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="restaurant-phone">Phone Number</label>
                    <input type="tel" id="restaurant-phone" class="form-control" value="{{ restaurant.phone }}">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="restaurant-email">Email</label>
                    <input type="email" id="restaurant-email" class="form-control" value="{{ restaurant.email }}">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="restaurant-description">Description</label>
                    <textarea id="restaurant-description" class="form-control" rows="4">{{ restaurant.description }}</textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Logo</label>
                    <div style="margin-top: 8px;">
                        <img src="{{ restaurant.logo_url or '/static/images/default-logo.png' }}" alt="Restaurant Logo" style="max-width: 150px; max-height: 150px; border-radius: 4px;">
                        <button type="button" class="btn btn-outline btn-sm" style="margin-left: 10px;">Change Logo</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
        
        <!-- Business Hours Tab -->
        <div id="business-hours-tab" class="tab-content">
            <h2 class="section-title">Business Hours</h2>
            <p class="text-gray-600 mb-4">Set your restaurant's operating hours. Customers will only be able to place orders during these times.</p>
            
            <div class="business-hours">
                {% for day in ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'] %}
                <div class="business-hour-row">
                    <div class="day-label">{{ day }}</div>
                    <div class="time-inputs">
                        <input type="time" class="time-input" value="09:00">
                        <span>to</span>
                        <input type="time" class="time-input" value="22:00">
                    </div>
                    <div class="closed-checkbox">
                        <input type="checkbox" id="{{ day|lower }}-closed">
                        <label for="{{ day|lower }}-closed">Closed</label>
                    </div>
                </div>
                {% endfor %}
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-primary">Save Business Hours</button>
                </div>
            </div>
        </div>
        
        <!-- Menu Management Tab -->
        <div id="menu-tab" class="tab-content">
            <h2 class="section-title">Menu Management</h2>
            <div style="margin-bottom: 20px;">
                <button class="btn btn-primary">Add New Category</button>
                <button class="btn btn-outline" style="margin-left: 10px;">Add New Item</button>
            </div>
            
            <div class="menu-categories">
                {% for category in menu_categories %}
                <div class="menu-category" style="margin-bottom: 30px; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                    <div style="background: #f9fafb; padding: 12px 15px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin: 0; font-size: 1.1em;">{{ category.name }}</h3>
                        <div>
                            <button class="btn-icon"><i class="fas fa-edit"></i></button>
                            <button class="btn-icon" style="color: #ef4444;"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    
                    <div class="menu-items" style="padding: 15px;">
                        {% for item in category.items %}
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f3f4f6;">
                            <div>
                                <div style="font-weight: 500;">{{ item.name }}</div>
                                <div style="font-size: 0.9em; color: #6b7280;">KSh {{ "%.2f"|format(item.price / 100) }}</div>
                            </div>
                            <div>
                                <button class="btn-icon"><i class="fas fa-edit"></i></button>
                                <button class="btn-icon" style="color: #ef4444;"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Staff Management Tab -->
        <div id="staff-tab" class="tab-content">
            <h2 class="section-title">Staff Management</h2>
            <div style="margin-bottom: 20px;">
                <button class="btn btn-primary">Add New Staff Member</button>
            </div>
            
            <div class="table-responsive">
                <table class="staff-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for staff in staff_members %}
                        <tr>
                            <td>{{ staff.name }}</td>
                            <td>{{ staff.email }}</td>
                            <td>{{ staff.role }}</td>
                            <td>
                                <span class="status-badge status-{{ 'active' if staff.active else 'inactive' }}">
                                    {{ 'Active' if staff.active else 'Inactive' }}
                                </span>
                            </td>
                            <td>
                                <div class="action-btns">
                                    <button class="btn-icon" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-icon" title="Reset Password" style="color: #2563eb;">
                                        <i class="fas fa-key"></i>
                                    </button>
                                    <button class="btn-icon" {% if staff.active %}title="Deactivate" style="color: #ef4444;"{% else %}title="Activate" style="color: #10b981;"{% endif %}>
                                        <i class="fas {% if staff.active %}fa-user-times{% else %}fa-user-check{% endif %}"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Notifications Tab -->
        <div id="notifications-tab" class="tab-content">
            <h2 class="section-title">Notification Settings</h2>
            
            <form id="notification-settings">
                <div style="margin-bottom: 25px;">
                    <h3 style="font-size: 1.1em; margin-bottom: 15px;">Email Notifications</h3>
                    
                    <div style="margin-bottom: 15px; padding: 15px; background: #f9fafb; border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div>
                                <label for="new-order-email" style="font-weight: 500;">New Order Notifications</label>
                                <p style="margin: 5px 0 0; font-size: 0.9em; color: #6b7280;">Receive email notifications for new orders</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="new-order-email" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px; padding: 15px; background: #f9fafb; border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div>
                                <label for="order-updates-email" style="font-weight: 500;">Order Status Updates</label>
                                <p style="margin: 5px 0 0; font-size: 0.9em; color: #6b7280;">Receive notifications when order status changes</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="order-updates-email" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 25px;">
                    <h3 style="font-size: 1.1em; margin-bottom: 15px;">SMS Notifications</h3>
                    
                    <div style="margin-bottom: 15px; padding: 15px; background: #f9fafb; border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div>
                                <label for="new-order-sms" style="font-weight: 500;">New Order SMS Alerts</label>
                                <p style="margin: 5px 0 0; font-size: 0.9em; color: #6b7280;">Receive SMS notifications for new orders</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="new-order-sms">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        
                        <div style="margin-top: 15px; display: none;" id="sms-settings">
                            <label class="form-label" for="phone-number">Phone Number</label>
                            <input type="tel" id="phone-number" class="form-control" placeholder="+254 700 000000" style="max-width: 300px;">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Save Notification Settings</button>
                </div>
            </form>
        </div>
        
        <!-- Billing Tab -->
        <div id="billing-tab" class="tab-content">
            <h2 class="section-title">Billing & Subscription</h2>
            
            <div style="margin-bottom: 30px; padding: 20px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                <h3 style="margin-top: 0; color: #0369a1;">Current Plan: <strong>Starter</strong></h3>
                <p>Your next billing date is <strong>September 30, 2023</strong></p>
                <button class="btn btn-outline" style="margin-top: 10px;">Upgrade Plan</button>
            </div>
            
            <div style="margin-bottom: 30px;">
                <h3 style="font-size: 1.1em; margin-bottom: 15px;">Payment Method</h3>
                <div style="display: flex; align-items: center; padding: 15px; background: white; border: 1px solid #e5e7eb; border-radius: 6px;">
                    <div style="margin-right: 15px; font-size: 1.5em;">
                        <i class="fab fa-cc-visa"></i>
                    </div>
                    <div style="flex-grow: 1;">
                        <div>Visa ending in 4242</div>
                        <div style="font-size: 0.9em; color: #6b7280;">Expires 12/25</div>
                    </div>
                    <button class="btn btn-outline btn-sm">Change</button>
                </div>
            </div>
            
            <div>
                <h3 style="font-size: 1.1em; margin-bottom: 15px;">Billing History</h3>
                <div style="border: 1px solid #e5e7eb; border-radius: 6px; overflow: hidden;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background-color: #f9fafb; text-align: left;">
                                <th style="padding: 12px 15px; font-weight: 500;">Date</th>
                                <th style="padding: 12px 15px; font-weight: 500;">Description</th>
                                <th style="padding: 12px 15px; font-weight: 500; text-align: right;">Amount</th>
                                <th style="padding: 12px 15px; font-weight: 500;">Status</th>
                                <th style="padding: 12px 15px; font-weight: 500;"></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for invoice in billing_history %}
                            <tr style="border-top: 1px solid #e5e7eb;">
                                <td style="padding: 12px 15px;">{{ invoice.date }}</td>
                                <td style="padding: 12px 15px;">{{ invoice.description }}</td>
                                <td style="padding: 12px 15px; text-align: right;">KSh {{ "%.2f"|format(invoice.amount / 100) }}</td>
                                <td style="padding: 12px 15px;">
                                    <span class="status-badge status-{{ 'active' if invoice.paid else 'inactive' }}">
                                        {{ 'Paid' if invoice.paid else 'Pending' }}
                                    </span>
                                </td>
                                <td style="padding: 12px 15px; text-align: right;">
                                    <a href="#" style="color: #4f46e5; text-decoration: none;">View</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Tab switching functionality
    document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            // Remove active class from all tabs and content
            document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            // Add active class to clicked tab
            tab.classList.add('active');
            
            // Show corresponding content
            const tabId = tab.getAttribute('data-tab');
            document.getElementById(`${tabId}-tab`).classList.add('active');
            
            // Save active tab to localStorage
            localStorage.setItem('settingsActiveTab', tabId);
        });
    });
    
    // Restore active tab from localStorage
    document.addEventListener('DOMContentLoaded', () => {
        const activeTab = localStorage.getItem('settingsActiveTab') || 'profile';
        document.querySelector(`.settings-tab[data-tab="${activeTab}"]`).click();
        
        // Toggle SMS settings based on checkbox
        const smsCheckbox = document.getElementById('new-order-sms');
        const smsSettings = document.getElementById('sms-settings');
        
        smsCheckbox.addEventListener('change', () => {
            smsSettings.style.display = smsCheckbox.checked ? 'block' : 'none';
        });
    });
    
    // Form submission
    document.getElementById('profile-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        // Add form submission logic here
        alert('Profile updated successfully!');
    });
    
    document.getElementById('notification-settings')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        // Add form submission logic here
        alert('Notification settings updated successfully!');
    });
</script>
{% endblock %}
